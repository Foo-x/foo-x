{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/tried-jujutsu/","result":{"data":{"markdownRemark":{"fields":{"slug":"/blog/tried-jujutsu/"},"id":"e88cd3e9-af34-5c50-a6d2-d3d40c8ca5fd","excerpt":"Git互換のバージョン管理システム jujutsu (jj) があります。\nいろいろ特徴はありますが、しばらくスルーしていました。\nGitでも特に困っていなかったからです。 しかし、ここ3日ほど触ってみたところ、jujutsu…","html":"<p>Git互換のバージョン管理システム <a href=\"https://github.com/jj-vcs/jj\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">jujutsu (jj)</a> があります。\nいろいろ特徴はありますが、しばらくスルーしていました。\nGitでも特に困っていなかったからです。</p>\n<p>しかし、ここ3日ほど触ってみたところ、jujutsuなしの生活には戻れなくなりました。\nこの記事では実際に使ってみて感じたメリットをまとめます。</p>\n<h2 id=\"jj-squash-で簡単にコミットを修正できる\" style=\"position:relative;\"><a href=\"#jj-squash-%E3%81%A7%E7%B0%A1%E5%8D%98%E3%81%AB%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%82%92%E4%BF%AE%E6%AD%A3%E3%81%A7%E3%81%8D%E3%82%8B\" aria-label=\"jj squash で簡単にコミットを修正できる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">jj squash</code> で簡単にコミットを修正できる</h2>\n<p>Gitでは直前のコミットであれば <code class=\"language-text\">git commit --amend</code> で修正できます。\nしかしそれ以前のコミットは以下のような操作が必要です。</p>\n<ul>\n<li><code class=\"language-text\">git rebase -i</code> して修正したいコミットをeditで変更し、コミットを修正後に <code class=\"language-text\">git rebase --continue</code> する\n<ul>\n<li>注意しないとコミットを削除してしまう可能性がある</li>\n</ul>\n</li>\n<li><code class=\"language-text\">git commit --fixup X</code> や <code class=\"language-text\">git commit --squash X</code> でコミットを作成後、<code class=\"language-text\">git rebase --autosquash X^</code> する</li>\n</ul>\n<p>jujutsuでは直前のコミットは <code class=\"language-text\">jj squash</code>、それ以前のコミットは <code class=\"language-text\">jj squash -r X</code> です。\n圧倒的に簡単です。</p>\n<h2 id=\"jj-new---insert-after--insert-before-でコミットとコミットの間に新しいコミットを簡単に作れる\" style=\"position:relative;\"><a href=\"#jj-new---insert-after--insert-before-%E3%81%A7%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%A8%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%AE%E9%96%93%E3%81%AB%E6%96%B0%E3%81%97%E3%81%84%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%82%92%E7%B0%A1%E5%8D%98%E3%81%AB%E4%BD%9C%E3%82%8C%E3%82%8B\" aria-label=\"jj new   insert after  insert before でコミットとコミットの間に新しいコミットを簡単に作れる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">jj new --insert-after/--insert-before</code> でコミットとコミットの間に新しいコミットを簡単に作れる</h2>\n<p>たとえば、あるタスクXの作業をしている途中に別のタスクYを先に済ませたほうが良いことに気づいたとします。\nGitであれば以下のような操作になります。</p>\n<ol>\n<li><code class=\"language-text\">git commit</code> で現在の修正をタスクX用のブランチにいったんWIPでコミットする</li>\n<li><code class=\"language-text\">git checkout -b branch-y master</code> でタスクY用のブランチにチェックアウトする</li>\n<li>タスクYの修正を行う</li>\n<li><code class=\"language-text\">git add</code> して <code class=\"language-text\">git commit</code> する</li>\n<li><code class=\"language-text\">git checkout branch-x</code> でタスクX用のブランチに戻る</li>\n<li><code class=\"language-text\">git rebase branch-y</code> でタスクX用のブランチをタスクY用のブランチにrebaseする</li>\n</ol>\n<p>WIPコミットは代わりにstashでも良いですが、流れは大きく変わらないです。</p>\n<p>jujutsuの場合は以下の通りです。</p>\n<ol>\n<li><code class=\"language-text\">jj new --insert-before @</code> で現在のコミットの前に新しいコミットを作成する\n<ul>\n<li><code class=\"language-text\">jj new --insert-after @-</code> でも同様</li>\n</ul>\n</li>\n<li>タスクYの修正を行う</li>\n<li><code class=\"language-text\">jj bookmark create branch-y</code> でタスクY用のブックマークを作成する\n<ul>\n<li>Gitのブランチに相当するものをjujutsuではブックマークと呼ぶ</li>\n</ul>\n</li>\n<li><code class=\"language-text\">jj next --edit</code> もしくは <code class=\"language-text\">jj edit @+</code> でタスクX用のコミットに移動する</li>\n</ol>\n<p>jujutsuは修正が自動でコミットされるので、手動でコミットする必要がありません。\nまたカレントブランチという概念がなく、修正が確定してからブックマークを作成したり移動させたりします。\nしたがってrebaseが不要です。</p>\n<p>なお現在のコミットの直前に新しいコミットを作る場合は <code class=\"language-text\">jj split</code> でも可能です。\n<code class=\"language-text\">jj new --insert-after/--insert-before</code> は任意の箇所に挿入できます。</p>\n<h2 id=\"jj-undo-で簡単にロールバックできるので雑に操作できる\" style=\"position:relative;\"><a href=\"#jj-undo-%E3%81%A7%E7%B0%A1%E5%8D%98%E3%81%AB%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%A7%E9%9B%91%E3%81%AB%E6%93%8D%E4%BD%9C%E3%81%A7%E3%81%8D%E3%82%8B\" aria-label=\"jj undo で簡単にロールバックできるので雑に操作できる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">jj undo</code> で簡単にロールバックできるので雑に操作できる</h2>\n<p>Gitでは操作を取り消す方法がそれぞれ異なります。</p>\n<ul>\n<li>コミットを戻す\n<ul>\n<li><code class=\"language-text\">git reset</code></li>\n</ul>\n</li>\n<li>rebase/merge でコンフリクトが発生する前に戻す\n<ul>\n<li><code class=\"language-text\">git rebase/merge --abort</code></li>\n</ul>\n</li>\n<li>rebase実行後に元の状態に戻す\n<ul>\n<li>戻したい分岐元にrebaseしなおす</li>\n</ul>\n</li>\n<li>resetを戻す\n<ul>\n<li><code class=\"language-text\">git reflog</code> して戻したい箇所にcheckoutする</li>\n</ul>\n</li>\n</ul>\n<p>操作によっては戻せなかったり戻せても面倒だったりするので、Gitのコマンドを実行するときは少し覚悟が要ります。</p>\n<p>jujutsuではすべて <code class=\"language-text\">jj undo</code> です。\nまた <code class=\"language-text\">jj op log</code> で操作ログが確認できて、戻したい操作を指定してundoできます。\n雑に操作できて覚悟する負荷が減るのが嬉しいです。\n試しに操作して結果を確認したりもできます。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>jujutsuを使ってみて良かったところをまとめました。\nただ私がそうだったように、実際に試してみないとあまり実感できないと思います。\n<code class=\"language-text\">jj git init --colocate</code> や <code class=\"language-text\">jj git clone --colocate</code> でGitとも併用できるので、ぜひ試してみるのをおすすめします。</p>\n<h2 id=\"注意\" style=\"position:relative;\"><a href=\"#%E6%B3%A8%E6%84%8F\" aria-label=\"注意 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>注意</h2>\n<p>2024年現在のバージョンは0.24で、バージョンアップのたびに破壊的変更が入る可能性があります。\nまた以下の機能がまだサポートされていません。</p>\n<ul>\n<li>タグの操作\n<ul>\n<li>一覧表示はできます</li>\n<li>ただGitコマンドで操作できるので困りません</li>\n</ul>\n</li>\n<li>Hooks\n<ul>\n<li>pre-commitやpre-pushなどが実行されません</li>\n</ul>\n</li>\n<li>Partial Clone\n<ul>\n<li><code class=\"language-text\">git config unset remote.origin.partialclonefilter</code> から <code class=\"language-text\">git fetch --refetch</code> のようにして解除する必要があります</li>\n</ul>\n</li>\n<li>Sparse Checkout\n<ul>\n<li><code class=\"language-text\">git sparse-checkout disable</code> で解除する必要があります</li>\n</ul>\n</li>\n<li>Submodules</li>\n<li>Git LFS</li>\n<li>.gitattributes</li>\n</ul>","frontmatter":{"title":"jujutsuを試したら手放せなくなった3つの理由","date":"2024-12-29","description":null,"header":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/727be69d35bd6a676c5aa1ee72414efe/5267c/header.jpg","srcSet":"/static/727be69d35bd6a676c5aa1ee72414efe/7284f/header.jpg 750w,\n/static/727be69d35bd6a676c5aa1ee72414efe/29ba9/header.jpg 1080w,\n/static/727be69d35bd6a676c5aa1ee72414efe/c8896/header.jpg 1366w,\n/static/727be69d35bd6a676c5aa1ee72414efe/5267c/header.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/727be69d35bd6a676c5aa1ee72414efe/57584/header.webp 750w,\n/static/727be69d35bd6a676c5aa1ee72414efe/984df/header.webp 1080w,\n/static/727be69d35bd6a676c5aa1ee72414efe/4a276/header.webp 1366w,\n/static/727be69d35bd6a676c5aa1ee72414efe/9c00f/header.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.6666666666666666}}},"ogp":{"publicURL":"/static/e667dae429ce05dcdcba076f64271a4a/ogp.jpg"},"tags":["jujutsu","jj","Git"]},"tableOfContents":"<ul>\n<li><a href=\"#jj-squash-%E3%81%A7%E7%B0%A1%E5%8D%98%E3%81%AB%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%82%92%E4%BF%AE%E6%AD%A3%E3%81%A7%E3%81%8D%E3%82%8B\"><code class=\"language-text\">jj squash</code> で簡単にコミットを修正できる</a></li>\n<li><a href=\"#jj-new---insert-after--insert-before-%E3%81%A7%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%A8%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%AE%E9%96%93%E3%81%AB%E6%96%B0%E3%81%97%E3%81%84%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%82%92%E7%B0%A1%E5%8D%98%E3%81%AB%E4%BD%9C%E3%82%8C%E3%82%8B\"><code class=\"language-text\">jj new --insert-after/--insert-before</code> でコミットとコミットの間に新しいコミットを簡単に作れる</a></li>\n<li><a href=\"#jj-undo-%E3%81%A7%E7%B0%A1%E5%8D%98%E3%81%AB%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%A7%E9%9B%91%E3%81%AB%E6%93%8D%E4%BD%9C%E3%81%A7%E3%81%8D%E3%82%8B\"><code class=\"language-text\">jj undo</code> で簡単にロールバックできるので雑に操作できる</a></li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n<li><a href=\"#%E6%B3%A8%E6%84%8F\">注意</a></li>\n</ul>"}},"pageContext":{"id":"e88cd3e9-af34-5c50-a6d2-d3d40c8ca5fd"}},"staticQueryHashes":["1025666349","2148507062","4241674040","739241604"],"slicesMap":{}}