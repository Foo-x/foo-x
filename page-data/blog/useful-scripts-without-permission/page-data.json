{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/useful-scripts-without-permission/","result":{"data":{"markdownRemark":{"fields":{"slug":"/blog/useful-scripts-without-permission/"},"id":"47f976e8-e6bf-5dbf-9d19-7009c826d248","excerpt":"Coinhive事件が無罪になった。\nWebエンジニアとしては、新しい技術が潰されなくて良かった。 ただ、私がCoinhiveを使うことはないと思う。\n最近 Apple Pay を初めて使ったレベルなので、仮想通貨とかこわい。 Coinhive…","html":"<p><a href=\"https://note.com/morois/n/n04022db1f76c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Coinhive事件が無罪になった</a>。\nWebエンジニアとしては、新しい技術が潰されなくて良かった。</p>\n<p>ただ、私がCoinhiveを使うことはないと思う。\n最近 Apple Pay を初めて使ったレベルなので、仮想通貨とかこわい。</p>\n<p>Coinhiveは無断で実行されることが問題視されているらしい。\n広告も無断で表示されるが、目に見える広告は問題なく、見えないCoinhiveはダメという意見が多い。</p>\n<p>Webアプリを作ったことがある人には当たり前だが、画面に表示せずに無断で実行するスクリプトはたくさんある。\nというより、ほとんどのスクリプトは無断で実行される。\n今回はその中でもいろんなサイトで使われているものを挙げてみる。</p>\n<p>なお、CoinhiveにはCPU使用率の問題もあるが、ここでは無視する。\nCoinhiveの違法性（合法性）に関する議論は以下がわかりやすい。</p>\n<ul>\n<li><a href=\"http://takagi-hiromitsu.jp/diary/20180610.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">高木浩光＠自宅の日記 - 懸念されていた濫用がついに始まった刑法19章の2「不正指令電磁的記録に関する罪」</a></li>\n<li><a href=\"https://www.naka2656-b.site/archives/31413689.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">コインハイブ事件の最高裁の弁論の検察側の主張がひどいことを考えた（追記あり） : なか2656のblog</a></li>\n<li><a href=\"https://www.naka2656-b.site/archives/31835597.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">【速報】コインハイブ事件の最高裁判決で無罪判決が出される : なか2656のblog</a></li>\n</ul>\n<h2 id=\"アクセス解析\" style=\"position:relative;\"><a href=\"#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A7%A3%E6%9E%90\" aria-label=\"アクセス解析 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>アクセス解析</h2>\n<p>Webサイトにアクセスしたユーザの属性や行動を分析することをアクセス解析と言う。\n<a href=\"https://marketingplatform.google.com/about/analytics/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Google Analytics</a> が代表的なツールだ。おそらくほとんどのサイトで使われている。</p>\n<p>たとえば次のような行動を取得する。</p>\n<ul>\n<li>アクセス</li>\n<li>スクロール</li>\n<li>クリック</li>\n<li>動画の再生</li>\n</ul>\n<p>なお、Google Analytics は無断で実行されるが、<a href=\"https://marketingplatform.google.com/about/analytics/terms/jp/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">プライバシーポリシーなどに使っている旨を記載する必要がある</a>。</p>\n<p>ちなみにYouTubeも定期的にユーザの属性や行動をサーバに送信している。</p>\n<h2 id=\"captcha\" style=\"position:relative;\"><a href=\"#captcha\" aria-label=\"captcha permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CAPTCHA</h2>\n<p>CAPTCHAとは、Completely Automated Public Turing test to tell Computers and Humans Apart の略で、日本語だと「完全に自動化された、コンピュータと人間を区別する公開チューリングテスト」という意味。（長い）\n要するに人間かボットかを判断する仕組みで、一度は見たことがある人も多いはず。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 389px; white-space: initial\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ecef369adad2ac6a5f58b9e37353115/00a4e/recaptcha.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA7ElEQVR42nVRu07EMBD0/38BBT0tHQU6PoICiIQUR+Rx5KH48vIrzqDdwydTUIx25B2PZ9fCOYcIa+2/SHVXLVULBAcg3M7Fuq5YlgXGGHjv/2Dfd67U01pzvXIDazTmzeD+ecTdwxv3CWKaJmzbhnEcUdc1mqZBWZZo2xZSSlRVxf00LZnu3mFQKx5Pr3h6eYfWlNpAzPPMAqUUX87znI3INMsyFEVxM4wJeQXe43JRyD8/0J6/sPz6CBLTyCSiEUMIDOLHcTBPzSK6ruPHm/M3pCw4ABumoriHCHos3V2Kvu/ZlCYkPgwDf8oPJbjMnbjN6oUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7ecef369adad2ac6a5f58b9e37353115/6ea66/recaptcha.webp 315w,\n/static/7ecef369adad2ac6a5f58b9e37353115/b1289/recaptcha.webp 389w\"\n              sizes=\"(max-width: 389px) 100vw, 389px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7ecef369adad2ac6a5f58b9e37353115/6bdcf/recaptcha.png 315w,\n/static/7ecef369adad2ac6a5f58b9e37353115/00a4e/recaptcha.png 389w\"\n            sizes=\"(max-width: 389px) 100vw, 389px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7ecef369adad2ac6a5f58b9e37353115/00a4e/recaptcha.png\"\n            alt=\"recaptcha\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>もちろんチェックボックスへのチェックだけで判断しているわけではない。\nアクセスしてからチェックされるまでの時間や、カーソルやスクロールの動きなどを見ている。\n人間にはランダム性があるが、ボットは直線的なので判断できるというわけだ。</p>\n<p>下のサイトがわかりやすい。</p>\n<p><a href=\"https://persol-tech-s.co.jp/i-engineer/technology/securitycaptcha\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">「私はロボットではありません」はワンクリックでなぜ人間を判別できる？ 仕組みとその限界を聞いてきた | i:Engineer(アイエンジニア)｜パーソルテクノロジースタッフのエンジニア派遣</a></p>\n<p>つまり、それらのデータが無断で監視されている。</p>\n<h2 id=\"service-worker\" style=\"position:relative;\"><a href=\"#service-worker\" aria-label=\"service worker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Service Worker</h2>\n<p>Service Worker は、オフラインでもWebアプリを使えるようにする技術だ。\nサイトにアクセスした時にコンテンツのダウンロードとキャッシュをさせることで実現している。</p>\n<p>たとえば <a href=\"https://qiita.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Qiita</a> で適当な記事を開く。機内モードなどでオフラインにする。\nその状態でページを更新しても問題なく記事を読める。\nService Worker が導入されていないサイトではブラウザのエラー画面が表示される。</p>\n<p>ユーザがアクセスしていないコンテンツでも、あらかじめ（無断で）ダウンロードさせることができる。</p>\n<p>ちなみにバックグラウンドでデータを同期させることもできる。\nCoinhiveはサイトを閉じれば止まるが、このバックグラウンド同期はブラウザを閉じても実行される。もっとやばい。</p>\n<p>ただ、安心してほしい。バックグラウンド同期は実行時間に制限があるのでマイニングには使えない。</p>\n<p><a href=\"https://developers.google.com/web/updates/2015/12/background-sync#permissions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Introducing Background Sync | Web | Google Developers</a></p>\n<blockquote>\n<p>The event execution time is capped, so you can’t use them to ping a server every x seconds, mine bitcoins or whatever.</p>\n</blockquote>\n<h2 id=\"prefetch\" style=\"position:relative;\"><a href=\"#prefetch\" aria-label=\"prefetch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>prefetch</h2>\n<p>やたらサクサク動作するサイトはだいたいprefetchを使っている。\nService Worker と同じように、コンテンツのダウンロードとキャッシュをさせる仕組みだ。</p>\n<p>Service Worker はサイトごとに設定するのに対して、prefetchはページごとに設定する。\nたとえば、記事のリストが表示されたページにアクセスした時点で、それらの記事の内容をダウンロードさせることができる。</p>\n<p>なお、prefetchは Resource Hints のひとつであり、他にも dns-prefetch、preconnect、prerenderがある。</p>\n<p>下のサイトが詳しい。</p>\n<p><a href=\"https://blog.members.co.jp/article/33474\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">少ない手間でそのWebページに適した手法で表示高速化ができるResource Hintsがすごい｜コラム｜メンバーズ</a></p>\n<p>これも普通はユーザに許可を取らない。</p>\n<h2 id=\"技術と法律\" style=\"position:relative;\"><a href=\"#%E6%8A%80%E8%A1%93%E3%81%A8%E6%B3%95%E5%BE%8B\" aria-label=\"技術と法律 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>技術と法律</h2>\n<p>無断で実行されるスクリプトが違法かどうかは国によって違う。\n上で挙げた <a href=\"https://gigazine.net/news/20220120-google-analytics-illegal-europe/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Google Analytics も違法な場合がある</a>。</p>\n<p>Coinhiveは勝手にCPUを使うが、動画広告は勝手に通信量を消費する。\n最近話題のメタバースは個人情報の扱いが問題視されている。</p>\n<p>技術者は、技術だけでなく法律も勉強しないといけない。</p>","frontmatter":{"title":"無断で実行される便利なスクリプト","date":"2022-01-22","description":null,"header":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/47de131d1e9bdf3129a4e3cc7272f653/d5217/header.jpg","srcSet":"/static/47de131d1e9bdf3129a4e3cc7272f653/7284f/header.jpg 750w,\n/static/47de131d1e9bdf3129a4e3cc7272f653/64b93/header.jpg 1080w,\n/static/47de131d1e9bdf3129a4e3cc7272f653/2baac/header.jpg 1366w,\n/static/47de131d1e9bdf3129a4e3cc7272f653/d5217/header.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/47de131d1e9bdf3129a4e3cc7272f653/57584/header.webp 750w,\n/static/47de131d1e9bdf3129a4e3cc7272f653/90a5d/header.webp 1080w,\n/static/47de131d1e9bdf3129a4e3cc7272f653/1e947/header.webp 1366w,\n/static/47de131d1e9bdf3129a4e3cc7272f653/618ea/header.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.6661458333333333}}},"ogp":{"publicURL":"/static/d28b87944856a5231263db0c599c223e/ogp.jpg"},"tags":["JavaScript","法律"]},"tableOfContents":"<ul>\n<li><a href=\"#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A7%A3%E6%9E%90\">アクセス解析</a></li>\n<li><a href=\"#captcha\">CAPTCHA</a></li>\n<li><a href=\"#service-worker\">Service Worker</a></li>\n<li><a href=\"#prefetch\">prefetch</a></li>\n<li><a href=\"#%E6%8A%80%E8%A1%93%E3%81%A8%E6%B3%95%E5%BE%8B\">技術と法律</a></li>\n</ul>"}},"pageContext":{"id":"47f976e8-e6bf-5dbf-9d19-7009c826d248"}},"staticQueryHashes":["1025666349","2148507062","4241674040","739241604"],"slicesMap":{}}